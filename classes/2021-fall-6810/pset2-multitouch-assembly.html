<!DOCTYPE html>
<html>
<head>
	<title>HCI Engineering Group</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

	<!-- CSAIL ICON -->
	<link rel="CSAIL" href="../../images/icon/csail.ico" type="image/x-icon" />

	<!-- Bootstrap -->
	<link href="../../css/bootstrap.css" rel="stylesheet">
	<link href="../../css/custom-style.css" rel="stylesheet">

	<!-- jQuery -->
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Abel" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Barlow" rel="stylesheet">

	<!-- Google Analytic -->
	<script type="text/javascript" src="../../js/analytics.js"></script>

	<style>
	.etech-sch-col1 {width:60px; border: 1px solid black;padding:10px;}
	.etech-sch-col2 {width:120px; border: 1px solid black;padding:10px;}
	.etech-sch-col3 {width:450px; border: 1px solid black;padding:10px;}
	.etech-sch-col4 {width:70px; border: 1px solid black;padding:10px;}
  .etech-sch-col5 {width:70px; border: 1px solid black;padding:10px;}
  /*.etech-sch-col6 {width:170px; border: 1px solid black;padding:10px;}*/
  ul {
    padding:0px;padding-left:10px;margin:0px;
  }
	</style>
</head>

<body>
<header class="main_header">
	<!-- to be filled by javascript, see header.html -->
</header>

<section class="main_container">
	<div class="container">
    <div class="row nothing">

      <section class="col-md-8 pull-right main-content">
</br></br></br></br>
        <h4 class="medium.headline"><a href="6810-engineering-interactive-technologies.html">6.810 Engineering Interactive Technologies (fall 2021)</a><br></h>
        <h2 class="headline">Pset2: Assembling the Multi-Touch Pad and Circuit</h2>

In this problem set, you will print out your multi-touch pad on the conductive inkjet printer and assemble the top and bottom layer together. After this, you will build the touch sensing circuit and connect your multi-touch pad to it. As part of building the circuit, you will also have to solder some of the components with header pins first. At the end of this problem set, you will download a piece of test code that will verify that you assembled your multi-touch pad and the corresponding circuit correctly, i.e. the test code will verify that your hardware can sense touch data from a user's finger.<br><br>

<b>Steps:</b>
<ol>
	<li>Inkjet Print and Assemble Top and Bottom Electrode Layers</li>
	<li>Connect the FPC Connectors to the Electrodes</li>
	<li>Build the Sending Circuit</li>
	<li>Build the Receiving Circuit</li>
</ol>

 <div style="color:black; border: black 1px solid; padding: 20px;margin-bottom:20px;">
<b>Ask a TA to give you the fabrication files (.pdfs) if something went wrong in pset1</b><br>
In case you did not finish pset1, you can ask a TA to provide you with the fabrication files (i.e., the two pdfs for the top and bottom electrode layer) so you can continue pset2. If you finished pset1, but upon review by the teaching team it turns out that your fabrication files have a problem that cannot be easily fixed, you can also ask a TA to give you the fabrication files.</div>

<h3>(1) Inkjet Print and Assemble Top and Bottom Electrode Layers</h3>

<b>Inkjet Print:</b> Once the TAs have verified the two fabrication files (.pdfs) you generated in pset1, you can print them out. Ask a TA to give you the two transparent sheets (one for the columns and one for the rows) you need for printing.<br> 
<span style="color:red">If you don't remember how to print, you can find information here (add link).</span><br><br>

<!-- <img src="images/lab11/pset1-printing-setting.png" width="600px"> <br><br> -->

<b>Assemble:</b> To assemble both sheets together, please ask a TA to help you with this either in lab or in an OH.<br><br> 

<b>Conductive side should face upwards:</b> First, check that both of your sheets have the conductive side facing upwards.<br><br>

<b>Align both electrode sheets:</b> Next, align both electrode sheets on top of each other. 
The alignment between the top and bottom electrodes is critical for receiving an accurate sensing signal.<br><br>

<b>Attach tape to maintain alignment:</b> To help maintain the relative alignment, we will tape the two sheets together on one side using regular scotch tape.<br><br>

<b>Flip top sheet over:</b> Flip the top layer up, so that the bottom layer is exposed and we can apply glue in the next step.<br><br>

<img src="images/pset2/pset1-scotch-tape.png" width="800px"> <br><br>

<b>Glueing with tape vs. tattoo transfer paper:</b> While you could use simple double-sided transparent tape for glueing the sheets together, the tape has a certain thickness to it. This is a problem because more space between the electrode layers results in worse sensing. The electrodes are already spaced out by the thickness of the sheet on which the electrodes were printed, so the tape would add even more thickness to it. To keep the glue layer as thin as possible, you will instead use the <a href="https://www.amazon.com/gp/product/B0043WJ3OA/ref=ppx_yo_dt_b_search_asin_title?ie=UTF8&psc=1">adhesive of temporary transfer paper</a>.<br><br>

<b>Using the tattoo transfer paper to glue top and bottom sheet together:</b> Ask a TA to give you the tattoo transfer paper and help you with this step. Pull off the protective cover from one side of the tattoo transfer paper, then attach the now exposed sticky side of the tattoo transfer paper to the bottom electrode sheet to cover all the electrodes (no need to cover the wires). Next, remove the second protective cover from the other side of the tattoo transfer paper to reveal the second sticky side. Now flip back the top electrode layer to make everything sticks together (check your electrode alignment one more time before you do this).<br><br>

<img src="images/pset2/pset1-tatto-paper.png" width="600px"> <br><br>

<b>Protecting the top sheet with a transparent cover:</b> Finally, since the conductive side of the top sheet is facing towards the user, the top electrodes are still exposed and you need to cover them up to prevent the user from touching them directly. For this, you will add a transparent film on top, which we will also give you in lab/at the OH. You can attach the transparent sheet by using scotch tape again. <br><br>

<img src="images/pset2/pset1-attach-transparent-sheet.png" width="300px"> <br><br>

<b>Laminating the Multi-touch pad:</b> <span style="color:red">to come once we figured out the lamination step. this may also replace the top cover step from above. to come once we figured out the lamination step. this may also replace the top cover step from above. to come once we figured out the lamination step. this may also replace the top cover step from above.</span><br><br>


<h3>(2) Connect the FPC Connectors to Electrodes</h3>

Once you have the multi-touch pad printed and assembled, you need to connect its inkjet printed wires to a breadboard so it can work with the rest of the circuit.<br><br> 

<b>FPC connectors:</b> In the labs, we used crocodile clamps to connect our inkjet printed circuit to a breadboard but for the multi-touch pad, the wire spacing is so tight that crocodile clamps will not work here. A component that is more suitable for our purposes is a Flexible Printed Circuit (FPC) Connector. The FPC connector has high resolution connectors on one side, which we will use to connect to the inkjet printed circuit, and on the other side has more widely spaced connectors, which we can use to connect to our breadboard. We bought these <a href="https://www.amazon.com/gp/product/B07VCJG54G/ref=ppx_yo_dt_b_asin_title_o00_s00?ie=UTF8&psc=1">FPC connectors here</a>.<br><br>  

<b>Soldering header pins onto the FPC connectors:</b> You have two FPC connectors, one for the top and one for the bottom electrodes. Since they don't have the header pins on them yet, you need to solder them on yourself. You have some header pins in your fabrication bag for this.<br> <span style="color:red">Add a note and photos for how to correctly solder to keep the pins straight by inserting into breadboard.</span><br><br>

<img src="images/pset2/fpc-without-headers.png" width="330px"><img src="images/pset2/headerpins.png" width="170px"><img src="images/pset2/fpc-with-headers.jpg" width="220px"><br><br>

<span style="color:red"><b>Testing if each pin on your FPC chip is soldered:</b> How can the students test if each pin on the FPC connector is correctly soldered, i.e. makes a connection to the header pin?</span><br><br>

<b>Cut out area around multi-touch wires for FPC connection:</b> The multi-touch pad wires will need to fit into the FPC connector. Thus, you need to cut out some free space around the wires on your multi-touch pad. When you cut out the area for the connector pay extra attention that it will fit inside the FPC connector. Check that the little pins inside the FPC connector head align with the wires of your multi-touch pad.<br><br>

<img src="images/pset2/aligning-inkjet-print-with-fpc.jpg" width="390px">
<img src="images/pset2/fpc-connector-slot.jpg" width="330px"><br><br>

<b>Connecting the FPC connectors to the wires of the multi-touch pad:</b> When you connect your FPC connector, make sure the conductive side with the silver traces is facing towards the breakout board. Pull out the little tab on the FPC connector, then insert the wires, then push the little tab back in to secure the wires. Once you are done connecting one side of the multi-touch pad, repeat the procedure with the other side and connect it to the second FPC connector.<br><br>

<img src="images/pset2/pset1-fpc-connector_2.png" width="600px"><br><br>

<!-- <b>(2) Flip-up:</b> <br> -->
<!-- <img src="images/pset2/pset1-fpc-connector_1.jpg" width="330px"><br><br> -->

<span style="color:red"><b>Testing if your FPC chip make a connection to each wire from the multi-touch pad:</b> How can the students test if the FPC connector is correctly connected to the multi-touch pad wires? can they use a multimeter and probe on the chip + on the circuit?</span><br><br>

<span style="color:red"><b>Disconnecting/Reconnecting Multi-Touch pad from Circuit:</b> Add a section on how to properly disconnect the FPC connectors if needed. Last year students unclipped the multi-touch pad at the front, but it would be better to remove the wires. We should show a photo here with correct/incorrect (maybe this should be further down in the sending circuit section?)</span><br><br>


<h3>(3) Build Sending Circuit</h3>

 <div style="color:black; border: black 1px solid; padding: 20px;margin-bottom:20px;">
<b>Use the large breadboard we gave you for the multi-touch pad circuit:</b><br>
For building the circuit, please use the large breadboard we gave you. The idea is that you use the large breadboard for your multi-touch pad and the small breadboards you received earlier for the labs. This way, you don't have to unplug any wires when you switch between working on labs vs. working on psets.</div>

As mentioned in lecture, the multitouch pad consists of sender electrodes (e.g., columns) and receiver electrodes (e.g., rows). A signal is injected into the sender electrodes and the receiver electrodes then pick up the signal and any modulation of it that occured because the user's finger is present. We will first build the sending circuit.<br><br> 

<b>Injecting Circuit:</b> The sending circuit injects a PWM signal into the sender electrodes. When powered, the multitouch pad is sending the PWM signal to the sender electrode columns one by one, i.e. first sends the PWM signal to the first sender electrode column, then the second, then the third and so on. After it reached the last sender electrode column, it continues again from the front.<br><br> 

<b>Number of Sender Pins:</b> Since we need to send a PWM signal to each column of electrodes individually one after another, sharing a single PWM sender pin like we did in lab does not work since it would send a signal to all electrodes simultaenously at the same time. To send a PWM signal one by one to each column, we thus need the same number of sender pins as we have columns. While we have enough GPIO/PWM pins on the ESP for our 8x9 multi-touch pad (i.e. 17 in total, 8 for receiving and 9 for sending), we would quickly run out of pins if we used a multi-touch pad with a higher resolution. We thus want to introduce a new component, i.e. a multiplexer, that allows you to scale up the number of pins you have available by reducing the number of ESP pins needed to send the signals.<br><br>

<img src="images/pset2/multitouch-schematic-sending.png" width="600px"> <br><br>

<b>Using a Multiplexer to Scale up the Number of Sender Pins:</b> A multiplexer can take one single input and direct it to multiple outputs (de-multiplexing). Thus, for sending, we can use a single pin on the ESP to generate the PWM signal and then pipe the signal through the multiplexer, which can direct it to the individual electrode column where the signal should be applied. We bought the following <a href="https://www.amazon.com/gp/product/B07K7JF3HX/ref=ppx_od_dt_b_asin_title_s00?ie=UTF8&psc=1">multiplexer from here.</a> You can find the <a href="https://www.ti.com/lit/ds/symlink/cd74hc4067.pdf?ts=1598252309140&ref_url=https%253A%252F%252Fwww.google.com%252F">datasheet here</a> and <a href="http://cdn.sparkfun.com/datasheets/BreakoutBoards/Analog-Digital-Mux-Breakout-v11.pdf"> the schematic file here</a>.<br><br>  

<img src="images/pset2/demux-labeled.png" width="400px"> <br><br>

<b>Soldering header pins onto the multiplexer:</b> The multiplexer we bought has no header pins attached yet, so you need to solder them on yourself. You have some header pins in your fabrication bag. After you are done soldering, it should look like this. <br><br>

<img src="images/pset2/multiplexer-no-headers.png" width="170px"> 
<img src="images/pset2/headerpins.png" width="150px"><img src="images/pset2/multiplexer.jpg" width="400px"> <br><br>

<span style="color:red"><b>Testing if each pin on your multiplexer is soldered:</b> How can the students test if each pin on the multiplexer is correctly soldered, i.e. makes a connection to the header pin?</span><br><br>

<b>Providing the Input Signal from the ESP (SIG):</b> First, let's start by providing our multiplexer with the input signal from the ESP. For this, connect the signal pin (SIG) on the multiplexer to one of the pins on the ESP that can generate a PWM signal (<span style="color:red">any GPIO pin works</span>). <br><br>

<b>Connecting the output channels to the electrode columns (C0-C8):</b> If you look at your multiplexer, you can see that it has 16 output channels (pins on the left side from C0-C15). We want to connect each output channel to one column of our multi-touch pad (we don't need all 16 channels since our multi-touch pad only had 9 columns). We can then use the multiplexer to redirect the input signal from the SIG pin to one of the channels, thereby injecting the signal into a specific column of the multi-touch pad. Connect each of your electrode colunmns to one of the pins. You can connect the FPC connector breakout boards to the multiplexer via male-to-female jumper wires and a breadboard.<br><br>

<span style="color:red">add an image of the FPC chip with jumper wires?</span><br><br>

<b>Selecting which Channel to send the Signal to (S0-S3):</b> The question remains how to we tell the multiplexer which channel our input signal should be directed to, i.e. how can we tell the multiplexer to send the input signal to e.g., the C12 output pin. The way our multiplexer does this is by asking us to send the desired output address using the four pins on the right side, labeled S0-S3. Why four pins? The multiplexer expects a binary signal, e.g. sending 0,0,0,0 to S0-S3 results in the output pin C0, vs. 0,1,1,0 send to to S0-S3 results in C6 as output pin. Thus, by using the multiplexer we can send a signal to up to 16 electrode columns (CH0-15)  using only 5 pins (SIG + S0,S1,S2,S3) on the ESP! Wire up the S0-S3 pins to <span style="color:red">GPIO pins on the ESP</span>.<br><br>

<b>Powering the Multiplexer:</b> Finally, connect the power VCC and GND pins on the multiplexer to the corresponding pins on the ESP to power the multiplexer.<br><br>

<img src="images/pset2/multiplexer.png" width="400px"> <br><br>

<span style="color:red">anything students can test here to see if they wired everything up correctly or do we do this at the very end?</span><br><br>

<h3>(4) Build Receiving Circuit</h3>

As you can see in the schematic, the circuit for receiving is very similar to what we have done in lab. Each touch-sensing row is connected to its own resistor and then connected to an ADC/TOUCH pin on the microcontroller.<br><br> 

<img src="images/pset2/multitouch-schematic-receiving.png" width="600px"> <br><br>

<b>Using a separate ADC component:</b> Unfortunately, the ADC/TOUCH pins on the ESP32 are not reliable enough for our purposes, i.e. they do not output clean enough signals for our multi-touch pad (footnote 1). We will thus use a separate ADC component that will replace the ADC pins on the ESP32. The component we use to have better ADC channels is the <a href="https://www.adafruit.com/product/856">MCP3008</a> chip and you can find <a href="https://cdn-shop.adafruit.com/datasheets/MCP3008.pdf">its datasheet here</a>.<br><br>

<img src="images/pset3/adc-pin-chip.png" width="250px"><br><br>

<b>Connecting the Receiving Electrodes to the ADC component:</b> Let's first connect the receiving electrodes from our multi-touch pad to the ADC component by connecting them to channel CH0 - CH7 (see component image below). Don't forget to add the 100kOhm resistor to each electrode row.<br><br>

<b>Powering the ADC component:</b> Next, power the ADC component by connecting the Vdd pin to 3.3V and the Dgnd pin to GND.<br><br>

<b>Reference Signal:</b> The MCP3008 chip also needs a reference voltage to calculate the unknown voltage from the incoming CH0-7 pins (ADC conversion). This reference voltage needs to be equal or less than the operating voltage of the ADC component. Since we use 3.3V on Vdd, you can connect the reference voltage pin VRef pin to 3.3V as well and then connect the AGND pin to ground.<br><br>

 <img src="images/pset2/mpc-pin-out-labeled.png" width="400px"> <img src="images/pset2/spi-labeled.png" width="270px"><br><br>

<b>Connecting the ADC component to the ESP:</b> Sending data from the ADC component to the ESP is a little more complicated. The MCP3008 chip communicates with the ESP via the Serial Peripheral Interface (SPI). We use basic SPI between one master (ESP) and one slave (MCP3008 chip). SPI communication is setup via 4 types of pins, i.e. MOSI is the line for the master to send data to the slave, MISO is the line for the slave to send data to the master, SCK is the line for the clock signal that determines how fast bits of data can be send, and NSS/CS is a line for the master to select which slave to send data to. The ADC chip uses different names on its pinout for these pins, i.e. <b>MOSI (DIn), MISO (DOut), SCK (CLK), and NSS/CS (CS/SHDN)</b> as shown above in the MPC chip pinout. The ESP uses the regular names as shown on the ESP pinout below. Wire up these four SPI pins between the ADC chip and the ESP.<br><br>

 <img src="images/pset3/esp32-pinout.png" width="750px"><br><br>

<b>Using a Multiplexer for the receiving circuit:</b> While we will not do it in this pset, we could also use a second multiplexer to reduce the number of pins required for the receiving circuit, i.e. the electrode rows. When using the multiplexer for receiving, we would redirect the received signal on CH0-15 to the SIG pin that is then read by the ESP. Similar to above, we would only have to specify which channel (CH0-15) we want to read and the ESP would then retrieve the signal from the respective channel. Thus, this second multiplexer would reduce the number of receiver pins by combining multiple rows into one pin on the ESP. <br><br>

<span style="color:red">How can the student test that everything works?</span><br><br>

<h3>Upload your Code and Design Files, Show Hardware to TA</h3>

For grading, please upload the following to your google drive student folder:<br>

<ul>
	<li>the .pde file of your Processing program</li>
	<li>the two .pdf files you used for conductive inkjet printing</li>
	<li>3-5 photos showing your assembled circuit from different perspectives (include top view + side views)</li>
	<!-- <li><span style="color:red">bring your assembled multi-touch pad to your spray session</span></li> -->
</ul>


<h3>Grading</h3>

We will give 20 pts in total:
<ul>
	<li>did you finish assembling your multi-touch pad, i.e. did you inkjet print both the top and bottom electrode layer, glued them together, and connected the FPC chips? (5 pts)</li>
	<li>did you correctly build the multi-touch sensing circuit using the multiplexer, resistors and ESP? (5 pts)</li>
</ul>


<!-- Footnote 1: Unfortunately, the ESP32 ADC/TOUCH pins are only reliable in the middle of the ESP's voltage range (~0.5V to maybe 3.0V) but not at the lower and upper ends of the range. Our touch sensing circuit functions at the lower range. Even worse, because our circuit (receiver pins) outputs between -0.6V and 1.2V (yes that is a minus), we end up with negative voltages on the ADC pins, which are completely out of the spec of the ESP32's ADC inputs and would create a signal that is non-linear and would require a lot of calibration. The reason we can have negative voltages is because we are practically generating a high-frequency AC signal with the PWM. This creates capacitive coupling between the breadboard channels and wires. To make the ESP ADC pins work with negative voltages, you could add rectification circuits and amplifiers before having the signal go into the ADC pin, but that is quite some extra effort. For our purposes, it is therefore easier to not use the ESP ADC pins and instead use another ADC component that can work well within the Voltage range we use for the multi-touch pad.<br><br>
 -->


        <br />
      </section>

      <aside class="col-md-4 pull-left">
         <br /> <br /> <br /> <br />
<!-- 				 <h4>Pset Steps</h4><br>
				 <ul>
		 			<li><a href="#pset1">pset1 (due Sept. 21, 11.59pm): laser cut and bend the acrylic base</a><br /></li>
		 			<li><a href="#pset2">pset2 (due Oct. 5, 1pm): insert LEDs, add USB connecting and solder everything</a><br /></li>
		 			<li><a href="#pset3">pset3 (due Oct. 19, 1pm): write touch recognition so that you can determine (x,y) location of each finger</a><br /></li>
		 			<li><a href="#pset4">pset4 (due Oct. 26, 1pm): add an application of your choice</a><br /></li>
				</ul>
				<br /> <br /> <br /> <br />
        <img src="../2018-fall-6810/images/multi-touch-pad/iap1.jpg" width="220px">
		<img src="../2018-fall-6810/images/multi-touch-pad/iap2.jpg" width="220px">
		<img src="../2018-fall-6810/images/multi-touch-pad//iap3.jpg" width="220px">
		<img src="../2018-fall-6810/images/multi-touch-pad/iap4.jpg" width="220px">
		<img src="../2018-fall-6810/images/multi-touch-pad/iap5.jpg" width="220px">
 -->



        <!-- Publication -->

        <br><br><br><br><br>

        <!-- Publication -->

<!-- <h4>Side Bar</h4><br>
    <ul>
      <li>Prof. Stefanie Mueller (Instructor)</li>
      <li>Lotta-Gili Blumberg (TA)</li>
      <li>Xin Wen (UTA)</li>
      <li>Loren Maggiore (LA)</li>
      <li>Mark Chounlakone (LA)</li>
    </ul>
 -->
</br>
</br>
</br>
</br>
</br>
</br>
</br>
</br>
</br>

      </aside>

    </div>
  </div>
  </div>
</section>

<div class="container">
	<div class="row">
		<div class="col-md-12 footer" style="text-align: center;">
			<span class="copyright">
			Since 2017 &copy; MIT CSAIL (HCI Engineering group) [redesign by
			<a href="http://punpongsanon.info/" target="_blank" style="text-decoration:none; border-bottom:0px">
			moji
			</a>].
			All Rights Reserved.

			<a href="http://mit.edu/" target="_blank" style="text-decoration:none; border-bottom:0px">
			<img src="../../images/logo/mit.svg" alt="MIT" class="footer-logo" />
			</a>
			<a href="http://csail.mit.edu/" target="_blank" style="text-decoration:none; border-bottom:0px">
			<img src="../../images/logo/csail.svg" alt="CSAIL" class="footer-logo"/>
			</a>
			<a href="http://hci.csail.mit.edu/" target="_blank" style="text-decoration:none; border-bottom:0px">
			<img src="../../images/logo/hci.svg" alt="HCI" class="footer-logo"/>
			</a>
			</span>
		</div>
	</div>
</div>

<!-- Bootstrap -->
<script type="text/javascript" src="../../js/bootstrap.min.js"></script>
<!-- header -->
<script type="text/javascript" src="../../js/headerstrap-for-subpage.js"></script>

</body>
</html>