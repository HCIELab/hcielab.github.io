<!DOCTYPE html>
<html>
<head>
	<title>HCI Engineering Group</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

	<!-- CSAIL ICON -->
	<link rel="CSAIL" href="../../../images/icon/csail.ico" type="image/x-icon" />

	<!-- Bootstrap -->
	<link href="../../css/bootstrap.css" rel="stylesheet">
	<link href="../../css/custom-style.css" rel="stylesheet">

	<!-- jQuery -->
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Abel" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Barlow" rel="stylesheet">

	<!-- Google Analytic -->
	<script type="text/javascript" src="../../js/analytics.js"></script>

	<style>
	.etech-sch-col1 {width:60px; border: 1px solid black;padding:10px;}
	.etech-sch-col2 {width:120px; border: 1px solid black;padding:10px;}
	.etech-sch-col3 {width:450px; border: 1px solid black;padding:10px;}
	.etech-sch-col4 {width:70px; border: 1px solid black;padding:10px;}
  .etech-sch-col5 {width:70px; border: 1px solid black;padding:10px;}
  /*.etech-sch-col6 {width:170px; border: 1px solid black;padding:10px;}*/
  ul {
    padding:0px;padding-left:10px;margin:0px;
  }
	</style>
</head>

<body>
<header class="main_header">
	<!-- to be filled by javascript, see header.html -->
</header>

<section class="main_container">
	<div class="container">
    <div class="row nothing">

      <section class="col-md-8 pull-right main-content">
</br></br></br></br>
        <h4 class="medium.headline"><a href="6810-engineering-interactive-technologies.html">6.810 Engineering Interactive Technologies (fall 2020)</a><br></h>
        <h2 class="headline">Building an Interactive Mug</h2>
In this lab, we will build an interactive mug that can sense its own temperature and signal the user if the content is too hot, too cold or just right. We will design an ink-jet printed temperature sensor to sense the heat of the mug and we will use the display which you sprayed in the last lab to signal to the user the current temperature of the mug's content.      
          <hr>

 <h3 class="headline">Your Task for Today</h3>
    You will create the interactive mug by following these steps:
    <ol>
        <li>Design an inkjet printed temperature sensor using Processing.</li>
        <li>Extend the inkjet printed temperature with wires to attach to your sprayed electrolumiscent (EL) display.</li>
        <li>Fabricate and assemble the printed circuit and EL display, then attach both to the mug.</li>
        <li>Build the circuit for the mug to read the temperature and control the EL display accordingly.</li>
        <li>Write the code that reads the current temperature and that adjusts the brightness of the EL display accordingly.</li>
    </ol>
    
<br>
    
    <img src="images/lab4/interactiveMug.jpg" width="300px">
    
    <h3 class="headline">Deliverables Lab 4 (due Friday, Oct. 2, 2020, 11.59pm)</h3>
    
    At the end of Lab 4, upload to your student google drive:
    <ul>
        <li>the Processing code (.pde) to generate the temperature sensor</li>
        <li>the Arduino code (.ino) for controlling your display and reading the temperature</li>
        <li>2-3 photos (.jpg or .png) from different angles of your mug</li>
        <li>a short video (.mov or .mp4, max. 1 minute) showing how you display's brightness increases when pouring in boiling hot water. It should start blinking after a few seconds when the mug reaches a high enough temperature.</li>
    </ul>
    
    <h3 class="headline">(1) Designing the inkjet printed temperature sensor</h3>

    First, you will use conductive inkjet printing to make your own temperature sensor from scratch.<br><br>

    <b>Why can conductive wires be used to sense temperature?</b><br>
    Conductive wires can be used to sense temperature by making use of a material property that most conductive metals share: Their resistance changes with changes in temperature. This property is called <b>thermal resistivity p</b> and is shown in the formula for determining the overall resistance of a wire below. As you can see, given a wire with a fixed length l and cross section A, the higher the thermal resistivity the higher the overall resistance. For our silver, the thermal resistivity p increases with increasing temperature. Thus, the higher the temperature, the higher the thermal resistivity and the higher the overall resistance of our wire. Thus, by reading the overall resistance of the wire with our microcontroller, we can determine the mug's temperature.<br><Br> 

    <img src="images/lab4/resistance.png" width="400px"><br><br>

    <b>How high should the resistance of the wire be to work as a reliable temperature sensor?</b><br>
    The higher the resistance of the conductive wire, the more sensitive it will be to temperature changes.<br>
    Consider the following, if you have a small resistor (e.g., 50Ohm) and the resistance changes a little bit (e.g. 5%), the change will be very small (i.e., 5% of 50Ohm = 2.5Ohm). This is difficult to measure since there is always a bit of noise in electronics. In contrast, if you use a large resistor (e.g., 1kOhm), the change will be larger (i.e., 5% of 1,000 Ohm = 50Ohm). Therefore, our ideal temperature sensor should be a wire with high resistance. <span style="color:red">We will tell you more later how we can determine exactly the value we need.</span> <br><br>

    <b>How can we create a conductive wire with high resistance?</b><br>
    If you look again at the image above, you can see that the resistance of a conductive wire is determined by its cross-section A and its length l. Note that when we talk about the cross-section A in our example here, we mean the width of the wire since the height will be the same for all our prints. <br> 
    To create a high resistance wire, should the <b>cross-section A</b> be larger or smaller?<br>
    To create a high resistance wire, should the <b>length of the wire l</b> be longer or shorter? <br>
    Look at the formula in the image.<br><br>


    To create a high resistance wire, the cross-section A (width of the wire) should be as small as possible.<br>
    To create a high resistance wire, the length of the wire should be as long as possible.

    <!--  We will conduct an experiment later in this lab to determine its resistance increase from room temperature to about 90C. -->

    <br><br>

    <b>How thin and how long should the wire be?</b><br>
    As you just figured out, the thinner and longer the conductive wire the higher the resistance. This helps us to sense temperature changes more precisely. Thus, a well designed temperature sensor should consist of a thin and long ink-jet printed silver trace <span style="color:red">such that small variations in resistance have a large effect on the overall resistance. (I don't understand this, shouldn't then a small resistance be better to begin with since changes have a larger effect?)</span> <span style="color:blue">if the resistance change is something like 5% then a 1kOhm resistor has an increase of 50Ohm. A small resistor of 1Ohm has then only an increase of 0.05Ohm -> harder to read</span><br><br>

    <i>Overall Resistance:</i> When writing this lab, we ran a few experiments and found that to work properly as a temperature sensor, our wire needs to have an overall resistance of 1kOhm.<br><br>

    <i>Smallest Thickness:</i>  We also found that the thinnest trace we can print is 0.3mm wide.
     Any thinner than this and the silver does not connect reliably anymore.<br><br> 
 
    <i>Resistance of a 1cm long trace:</i> When we print a trace of 0.3mm width and 1cm length, we find that it's resistance is 7.5 Ohm/cm at room temperature.<br>
     Note that this can vary depending on the substrate, the 2D printer, and the silver ink mixture, so if you change any of these you would have to remeasure the resistance.<br><br> 

     <i>Required Length of the wire for 1kOhm?</i> Assuming that the thermal resistivity p and the height of the trace is constant, how long does your conductive wire have to be to have 1kOhm resistance?<br>

     <span style="color:red">Mh, how can we derive this from the formula above?</span><span style="color:blue">hm, die 7.5Ohm/cm is die thermal resistance at room temperature. p(20C)=7.5Ohm/cm. Vllt so?:</span><br>
     We can estimate the resistance of a trace of length l at room temperature by calculating<br>
    
    <pre>resistance = l * p(20C) = l * 7.5 Ohm/cm</pre><br>


     <b>Shaping a long conductive wire into a compact form factor:</b><br>
    Now that we know how long the wire has to be, the next question that arises is how to best shape it to take up minimal space on our design? A classic method to create a long wire on a small area is to design it in a horse shoe pattern similar to this:<br><br>
    
    <img src="images/lab4/hsp.png" width="700px"><br><br>
       
    <b>Write Processing Script to generate line layout:</b><br>

    Since drawing this manually is quite the pain, we instead want to leverage our computational design capabilities in Processing. Write a Processing Script that generates a temperature sensor layout of variable length depending on a desired overall resistance. Reuse your code from pset1 to write this script. 

    In detail, the Processing script should have the following features:<br><br>
    <ol>
        <li>user input elements for line width (default: 0.3mm), overall resistance, and overall width of  temperature sensor (default: 7cm)</li>
        <li>generate a set of horizontal lines of the given width and connect them with vertical lines on alternating sides, the distance between each horizontal trace should be 0.5mm</li>
        <li>output a .pdf that contains the temperature sensor</li>
    </ol><br>
  
    Once you exported your pdf, you are ready to move onto the next step.<br><br>

    <h3 class="headline">(2) Extend Temperature Sensor Circuit with Wires<br> that Connect to EL display</h3>
    
    Now that we have our temperature sensor, it's time to plan how it will connect to the EL display so we can create the overall circuit layout that we want to attach to the mug. <br><br>

    Below, you see an image of the mug for reference. <br><br>

    <img src="images/lab4/mug.png" width="300px"><br><br>

    And further below you see an image of the overall circuit layout that fits onto the mug and has all the elements you need for the circuit.<br><br>

    <img src="images/lab4/mugCircuit.PNG" width="700px"><br><br>

    The circuit includes:<br><br>
    <ol>
        <li>the temperature sensor near the mug's handle</li>
        <li>your sprayed EL display on the opposite side of the handle <span style="color:red">(no overlap with the temperature sensor)</span></li>
        <li>4 connector pads to connect your microcontroller to the mug's circuit (1cmx3cm) </li>
        <li>2 printed wires that connect the temperature sensor to the connector pads (1mm) <span style="color:red">(thickness of wires?)</span></li>
        <li>2 printed wires that connect the EL display to the connector pads (2mm width, with a distance of a least 3cm at the location where they connect to the EL display to avoid shortcuts). Note that the location of these wires depends on where you put the copper flap and copper strip onto your sprayed EL display. If they are not at the bottom of the display but instead at the top, you need to route one of the wires above the temperature sensors.
        </li>
    </ol><br>

  For the total size aim for 17cm width and 7.5cm height so that the final design will fit nicely on the mug.<br><br>
    
    
    <h3 class="headline">(3) Fabrication and Assembly of Circuit, EL display, and Mug</h3><br>

    Now that you have the design ready, you can come in for fabrication and assembly.<br><br>

    <b>Ink-jet print your circuit</b><br>
    Once you are done with your circuit design, please put it in your google drive, let us know on slack that you are ready for inkjet printing, and then book an OH slot.<br><br>

    <span style="color:red">Before you come to the OH, make sure that the wires to the EL display are at the right position for YOUR display and the temperature sensor does not overlap with the display. Please bring the EL display with you to the OH so we can double check everything there.</span><br><br>
    
    Also when you come in, please don't forget to pick up:<br><br>
    <ol>
        <li>the mug</li>
        <li><span style="color:red">a 1 kOhm resistor</span></li>
        <li>a roll of copper tape</li>
    </ol>

    <img src="images/lab4/copper-tape.png" width="300px"><br><br>

    <b>Test resistance of your temperature sensor</b><br>
    Once your print is done and before you continue with assembly, check if the temperature sensor has a high enough resistance.<br> 
    Use a multimeter and hold its two electrodes on the two corresponding connector pads (see image below).<br> 
    Hopefully you will read a value close to 1 kOhm.<br>
    If not, please let us know and we can help debug.<br><br>

    <img src="images/lab4/testingTemperature.jpg" width="300px"><br><br>
    
    <b>Attach your sprayed EL Display on the Circuit</b><br>
    Once you have printed your circuit and verified that the temperature sensor is having the right resistance, you are ready to attach your EL display to it.<br><br>

    First lay your circuit on a flat surface. Take a roll of copper tape and cut of two 6cm long pieces. Glue one half of each copper stripe on the two wires that lead to your display and bend the other half around such that the adhesive side faces upwards.<br><br> 

    <img src="images/lab4/copperOpen.jpg" width="300px">
    <img src="images/lab4/copperClosed.jpg" width="300px"><br><br>

    Make sure that the two copper stripes don't connect to each other and have a save distance of at least 1cm. <br><br>

    Next, stick your display onto the bend-over copper stripes.<br>
    Make sure that one copper strip connects only to the ITO and the other copper strip only connects to the sprayed copper layer.<br><br>

    <img src="images/lab4/copperDisplay.jpg" width="300px">
    <img src="images/lab4/displayOnCopper.jpg" width="300px"><br><br> 

    <b>Test Display Connection</b><br>

    Now, it's time to test if the connection between the display and the printed traces is working.<br>
    Take your battery and inverter circuit and connect it to the two connector pads on the left hand side of the circuit. <br>
    You should see that the display lights up.<br> 
    We will have an inverter and power supply at the OH, so you don't have to bring your own.<br><br>

    <img src="images/lab4/displayTesting.jpg" width="300px"><br><br> 

    Once, you verified that everything works, you can tape the display on its edges onto the circuit sheet.<br> 
    Take some scotch tape and apply a stripe on the left and the right edge of your display.<br><br>

    <img src="images/lab4/scotchOnOneSide.jpg" width="300px">
    <img src="images/lab4/scotchOnBothSides.jpg" width="300px"><br><br>

    <b>Attaching the entire circuit to the mug</b><br>
    Now we are ready to attach the entire circuit to the mug.<br>
    For this, we will use double sided tape.<br>
    In the OH, cut off a tape strip the length of your circuit design, i.e. it should be 17cm and attach it across the surface of the mug.<br> 
    Next, also remove the protective foil from the tape such that it is also adhesive on the top side.<br><br>

    <img src="images/lab4/attachingTape.jpg" width="240x">
    <img src="images/lab4/mugWithTape.jpg" width="280px"><br><br>

    Now take your printed circuit and glue it onto your mug.<br><br>
    
    <img src="images/lab4/circuitToMug.jpg" width="250x">
    <img src="images/lab4/circuitOnMug.jpg" width="250px"><br><br>
    
    <b>Attach wires to your printed UI</b><br>
    
    Next, you'll need jumper wires that can connect the mug UI to a breadboard and your ESp32. We will use copper tape stripes and solder jumper wires on them to make that connection. Cut off 4 copper stripes of about 3cm length (depending on the size of your printed pads) and apply a drop of solder on them. Now, take a short jumper wire, hold it over the solder drop and press it down with the solder iron until it is well connected.<br><br>
    
    <img src="images/lab4/copperDrop.jpg" width="250x">
    <img src="images/lab4/jumperOnCopper.jpg" width="250px"><br><br>
    
    Repeat this for all 4 jumper wires.<br><br>
    
    Now, carefully attach the copper stripes onto your mug's connector pads.<br><br>
    <img src="images/lab4/fourConnectors.jpg" width="250x">
    <img src="images/lab4/jumpersAttached.jpg" width="250px"><br><br>
    
    To make the wires easier to work with, you can connect male-to-female jumper wires that you got in your grey boxes to the four dangling wires.<br><br>
    
    <img src="images/lab4/jumperTogether.jpg" width="300px"><br><br> 
    
    The last step in building the mug is to protect it from moisture and constant touching. Especially since we actually want to fill hot and cold water into it and measure its temperature. We will use clear tape to cover all the electronics.<br><br>
    
    Come to an OH and cut off a 19cm long stripe of our extra wide 3in tape. Carefully apply the tape on your UI. If you make a mistake here, you cannot remove the tape anymore since you might rip off the silver traces. Thus, be extra careful.<br><br>
    
    <img src="images/lab4/tapeOnDisplay.jpg" width="300px"><br><br> 

    <h3 class="headline">(4) Connecting to the Microcontroller and Building Remaining Circuit</h3><br>
    
    Controlling this UI requires 2 electronic components. You'll need (1) a circuit to control the EL display. You have completed this circuit already in lab 3 and will will use it in this lab. You also need (2) a circuit to read the resistance of your printed temperature sensor. We will start with building a circuit that can read resistance from voltage. <br><br>
    
    <b>Building the temperature sensor circuit</b><br>
    Recall, that the ESP 32 can only measure voltage but not resistance. A common circuit to reflect resistance changes via voltage is called <b>voltage divider</b>. It consists of one know and one unknown resistor that we want to measure. A schematic of a voltage divider looks like this:<br><br>
     <img src="images/lab4/voltage_divider.png" width="200px"><br><br>
    Vin is the 3.3V supply voltage from the ESp32 and Vout is a voltage than we will chnage depending on the following formula:<br><br>
    
    Vout = (R2*Vin)/(R1+R2)
    
    If we use the 1kOhm resistor that you picked up in the last OH as R1 and we connect the temperature sensor as R2, then we can solve the equation for R2.<br><br>
    Your task is to build a voltage divider on a breadboard and connect your temperature sensor to this circuit.<br><br>
    
    <b>Connecting the EL display control circuit</b>
    Finally, use your EL control circuit from lab 3 and connect it to the corresponding pins of the interactive mug.


    <h3 class="headline">(5) Code for Reading Mug's Current Temperature and Adjusting Display</h3><br>

    The goal of this lab part is to control the display through the temperature sensor. The display should be turned off when the mug is cold. It should turn on between 30 to 70C and should start blinking at >70C.<br><br>
    
    Start with connecting your voltage divider to the ESP32. Use analogRead(Pin) to read the incoming voltage value from your divider and write it to Serial with the Serial.println(value). analogRead() returns the read in voltage value between 0V and 3.3V and maps it to an output range of 0..4095. So, if you read a value of 2047, your voltage should be around 1.65V. Upload the code and if you have done everything right, you can visualize the read values with the Serial plotter.<br><br>
    
     <img src="images/lab4/raw.png" width="700px"><br><br>
    
    Now, it's time to apply the voltage divider formula from above. Use it to compute the resistance of your temperature sensor and plot the values. <br><br>
    
    You'll notice that the values are fluctuating a lot. This is due to the limited precision of the ESP32 and environmental electric noise that slightly changes the read in voltage values. <br><br>
    
    Recall from the lecture, that we introduced a filtering technique to smoothen out such values. It's called a box filter and it works by saving an array of sensor values (the box) of a specific width (e.g. 300 values) and computing the mean of this box. As new sensing values get read in through analogRead(), the box moves forward by one value, i.e. the oldest element in the array gets replaced by the new value and we recompute the mean.<br><br>
    
    Implement a box filter that smoothens out the values from analogRead(). Use a box width of 300 values. Once you have completed the filter, your results should look like this:
    <img src="images/lab4/filtered_large.png" width="700px"><br><br>
    You see that the filter first collects 300 values and the mean is increasing with every new value. When the box is full, we can have a stable resistance value. Below we see a zoomed in graph of the filtered values. The fluctuation is reduced to around 20Ohm  (instead of 300 without filtering)<br><br>
    <img src="images/lab4/filtered_small.png" width="700px"><br><br>

    <b>Measuring temperature with resistance increase</b><br>
    Now, it's time to conduct an experiment on the resistance change of the printed temperature sensor. Not down your current mean resistance at room temperature. Get some water to boil and pour it into the mug while you continue to plot the resistance values with the serial plotter. You should notice that the values start increasing while the mug is heating up. Once you reached a stable value, note it down as well. The value increase should be around 4%.<br><br>
    
    Next, use your temperature sensor values to set different states for your display. First, connect your display to the control circuit from lab 3. Then, program your ESP32 to turn on the display if the mug is above room temperature (around 40C) and let it blink if the temperature is too high to drink the beverage. This should be around the temperature when you just poured in boiling water (around 80C (water usually gets colder when you pour it into a cold mug)).<br><br> 
    
    Your final design should look like this:<br><br>

    <img src="images/lab4/interactiveMug.jpg" width="300px"><br><br>

    <h3 class="headline">Deliverables Lab 4 (due Friday, Oct. 2, 2020, 11.59pm)</h3>
    
    At the end of Lab 4, upload to your student google drive:
    <ul>
        <li>the Processing code (.pde) to generate a temperature sensor</li>
        <li>the Arduino code (.ino) for controlling your display and reading the temperature</li>
        <li>2-3 photos (.jpg or .png) from different angles of your mug</li>
        <li>a short video (.mov or .mp4, max. 1 minute) showing how you display blinks when pouring in boiling hot water. It should stop blinking while the mug cooles down and turn of at room temperature.</li>
    </ul>

<hr>

        <br />
        <br />
        <br />
      </section>

      <aside class="col-md-4 pull-left">
         <br /> <br /> <br /> <br /></br>
</br>
</br>
</br>
</br>
</br>
</br>
</br>
</br>

      </aside>

    </div>
  </div>
  </div>
</section>

<div class="container">
	<div class="row">
		<div class="col-md-12 footer" style="text-align: center;">
			<span class="copyright">
			Since 2017 &copy; MIT CSAIL (HCI Engineering group) [redesign by
			<a href="http://punpongsanon.info/" target="_blank" style="text-decoration:none; border-bottom:0px">
			moji
			</a>].
			All Rights Reserved.

			<a href="http://mit.edu/" target="_blank" style="text-decoration:none; border-bottom:0px">
			<img src="../../images/logo/mit.svg" alt="MIT" class="footer-logo" />
			</a>
			<a href="http://csail.mit.edu/" target="_blank" style="text-decoration:none; border-bottom:0px">
			<img src="../../images/logo/csail.svg" alt="CSAIL" class="footer-logo"/>
			</a>
			<a href="http://hci.csail.mit.edu/" target="_blank" style="text-decoration:none; border-bottom:0px">
			<img src="../../images/logo/hci.svg" alt="HCI" class="footer-logo"/>
			</a>
			</span>
		</div>
	</div>
</div>

<!-- Bootstrap -->
<script type="text/javascript" src="../../js/bootstrap.min.js"></script>
<!-- header -->
<script type="text/javascript" src="../../js/headerstrap-for-subpage.js"></script>

</body>
</html>
